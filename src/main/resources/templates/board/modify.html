<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìˆ˜ì •</title>
</head>
<body>
<nav th:replace="~{/layouts/header :: nav}"></nav>
<script>
    function addFileInput() {
         var fileInputs = document.querySelectorAll('input[type="file"]');
         if (fileInputs.length >= 5) {
             alert('íŒŒì¼ ì…ë ¥ í•„ë“œëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
             return;
         }
         var newRow = document.createElement('tr');
         var newCell = document.createElement('td');
         newCell.colSpan = 2;
         newCell.innerHTML = '<input type="file" name="files[]" class="fileclass" multiple="true" onchange="return checkFileSize()">' +
                             ' <input type="button" value="ì‚­ì œ" onclick="removeFileInput(this.parentNode.parentNode)">';
         newRow.appendChild(newCell);

         document.querySelector('#fileInputs').appendChild(newRow);
     }

     function removeFileInput(rowElement) {
         rowElement.parentNode.removeChild(rowElement);
         updateFileProgress(); // íŒŒì¼ì´ ì‚­ì œë˜ë©´ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
     }

    function updateFileProgress() {
        var totalSize = 0;
        var fileInputs = document.getElementsByClassName('fileclass');
        for (var i = 0; i < fileInputs.length; i++) {
            var files = fileInputs[i].files;
            for (var j = 0; j < files.length; j++) {
                totalSize += files[j].size; // íŒŒì¼ì˜ í¬ê¸°ë¥¼ í•©ì‚°
            }
        }
        var filelimit = 10 * 1024 * 1024; // 1MBë¥¼ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ê³„ì‚°
        var mb = 1024* 1024;
        var filemb = totalSize/mb;
        var ratio = totalSize / filelimit; // ë¹„ìœ¨ ê³„ì‚°
        var blocks = Math.min(Math.floor(ratio * 10), 10); // ë¹„ìœ¨ì— ë”°ë¼ ë¸”ë¡ ìˆ˜ ê³„ì‚°, ìµœëŒ€ 10ê°œ
        var remaining = 10 - blocks;
        var fileupSpan = document.getElementById('fileup');
        var mbmax = 10.00;
        fileupSpan.textContent = 'â– '.repeat(blocks) + 'â–¡'.repeat(remaining) + filemb.toFixed(2)+"MB";
        if(!(filemb <= mbmax)){
            alert("í—ˆìš© ìš©ëŸ‰ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤");
            return false;
        }
    }
    function checkFileSize() {
         updateFileProgress(); // íŒŒì¼ì´ ì¶”ê°€ë˜ê±°ë‚˜ ì‚­ì œë  ë•Œë§ˆë‹¤ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    }
</script>
<form id="boardForm" action="/board/modify_proc" method="post" enctype="multipart/form-data">
    <table align="center" border="1">
        <tr >
            <td>ê¸€ì“´ì´</td>
            <td><span th:text="${view.member.name}"></span><input type="hidden" th:value="${view.boardIdx}" name="boardidx"> </td>
        </tr>
        <tr>
            <td>ë¨¸ë¦¬ë§</td>
            <td><select name="prefaceIdx">
                <option th:each="pre:${preface}" th:value="${pre.prefaceIdx}"><span th:text="${pre.prefacename}"></span></option>
            </select>
            </td>
        </tr>
        <tr>
            <td>ì œëª©</td>
            <td><input type="text" th:value="${view.title}" name="title"></td>
        </tr>
        <tr >
            <td>ë‚´ìš©</td>
            <td><textarea th:text="${view.content}" name="content"></textarea></td>
        </tr>
        <tr>
            <td>ì²¨ë¶€íŒŒì¼<input type="button" value="ì¶”ê°€" onclick="addFileInput()"></td>
        </tr>
        <tr th:each="file:${view.files}">
            <td>
                <span th:text="${'ğŸ’¾'+file.realfilename}"></span>
                <input type="button" value="âŒ" th:onclick="'location.href=\'/board/filedelete?fileidx=' + ${file.fileidx} + '&boardIdx=' + ${view.boardIdx} + '\''">
            </td>
        </tr>
        <tbody id="fileInputs">
        <tr>
            <td colspan="2"><input type="file" name="files[]" class="fileclass" onchange="return checkFileSize()" multiple>
                <input type="button" value="ì‚­ì œ" onclick="removeFileInput(this.parentNode.parentNode)"></td>
        </tr>
        </tbody>

        <tr>
            <td colspan="2">
                <input type="submit" value="ìˆ˜ì •">
                <input type="button" value="ëª©ë¡ìœ¼ë¡œ" onclick="location.href='/board/board'">
            </td>
        </tr>
    </table>
</form>
<footer th:replace="~{/layouts/footer :: footer}"></footer>
</body>
</html>
